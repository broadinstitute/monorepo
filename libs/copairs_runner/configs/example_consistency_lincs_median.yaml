hydra:
  run:
    dir: ${oc.env:COPAIRS_OUTPUT,.}/output/lincs/shared/consistency_median
  job:
    chdir: false

input:
  path: "${oc.env:COPAIRS_DATA,.}/input/2016_04_01_a549_48hr_batch1_plateSQ00014812.csv"

preprocessing:
  steps:
    - type: filter_active
      params:
        activity_file: "${hydra:runtime.output_dir}/../activity/activity_map_results.csv"
        on_columns: "Metadata_broad_sample"
        threshold: 0.05
    - type: dropna
      params:
        columns: ["Metadata_target"]
    - type: aggregate_replicates
      params:
        groupby: ["Metadata_broad_sample", "Metadata_target"]
    - type: split_multilabel
      params:
        column: "Metadata_target"
        separator: "|"

average_precision:
  multilabel: true
  params:
    pos_sameby: ["Metadata_target"]
    pos_diffby: []
    neg_sameby: []
    neg_diffby: ["Metadata_target"]
    multilabel_col: "Metadata_target"

mean_average_precision:
  params:
    aggregation: median  # requires copairs@feat/median-average-precision
    sameby: ["Metadata_target"]
    null_size: 1000000
    threshold: 0.05
    seed: 0

output:
  directory: "${hydra:runtime.output_dir}"
  name: "consistency_median"
